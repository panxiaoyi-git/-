# 广告投放项目

## 第一章 业务介绍

### 第一节 业务流程

#### 	广告投放业务

​	互联网广告生态中，存在各种不同的参与者。各种专业名词让人觉得眼花缭乱，比如媒体（Media），publisher，AN, ATD, ADX, DSP, SSP, RTB，DMP，程序化广告等等。理清这些名词代表的意义并且梳理他们在广告生态中充当的角色，有助于从事商业变现的同学来理解整个广告商业系统。本质来说，广告的核心参与者只有三个：广告主，媒体（用户），中介。只不过在互联网广告中，在不断追求收入和利润的驱动下，由于技术的发展以及获取数据便捷，这个中介逐步发展成一个非常有技术含量的中介，于是就有了上述的各种专业名词。下面，将会以尽量通俗的语言来说明在广告活动中各个参与者之间的关系以及业务流程。

- 广告

​		即广而告之之意。广告是为了某种特定的需要，通过一定形式的媒体，公开而广泛地向公众传递信息的宣传手段。更多详细的说明，大家可以参考百度百科关于广告的定义或者《计算广告》里面的定义。



- 媒体（Media）

​	在互联网中主要专指网络媒体，借助互联网这个信息传播平台，以电脑、电视机以及移动电话等为终端，以文字、声音、图像等形式来传播新闻信息的一种数字化、多媒体的传播媒介。简单来说，就是能将文字、声音、图像传播给你的所有东西，都是媒体，比如你使用的app，你打开的网页，你玩的游戏，你收听的FM节目，看的视频等等都是媒体。



- 广告主（Advertiser）

  广告主是为推销商品或者提供服务的经济组织或者个人。在互联网广告生态系统中，通常就是花钱的那一方。

  

- 受众（Audiences）

​	广告的受众在广告生态链里面是被动的参与者，尽管参与活动不积极，但是受众在广告活动中却也充当相当重要的作用——行为数据以及标签。借助互联网技术，使得获取用户的行为和标签成为可能，才有了“让不同的受众展示不同的广告创意”这个革命性的广告里程碑成为可能



互联网广告生态链纷繁复杂，以下将一一对各个参与者以及业务流程进行简答的简述

- 广告直客

“直客”模式，是指绕过中间代理的广告模式。广告初期，业务流程都很简单，有流量的一方（媒体）需要商业变现，而有钱的一方（广告主）需要打广告来获取用户。于是双方一拍即合，我把广告位给你，你把广告费给我。这个时期，通常只是传统线下广告的简单迁移，结算方式一般是CPD（Cost Per Date），即采用合同的方式，确定某一广告位在某一个时间段内给到特定的广告主，比如20世纪初的AOL、Yahoo、新浪门户、搜狐门户等都曾采用这样的变现方式。这种方式就好比我们现在在公交站或者地铁站里面看到的橱窗广告，每隔一段时间，就会展示不同的广告

![](pic/ad-1.png)

媒体前端，通常是能触达到用户的那一端，比如网页、app客户端等。媒体服务器，简单来说就是存放广告的一个地方，是网站或者应用所属的公司或者组织用于管理广告主投放的广告的一个计算服务设备。媒体所在公司的商务同学跟广告主谈好价格、确定后广告创意等条件后，广告主就会将广告创意物料等相关材料发给媒体所属公司，用于进行广告投放，媒体（网页或者app）加载后，会向服务端（广告管理后台）请求广告，广告后台返回与前端协定好的广告数据格式，媒体前端根据返回的数据拼装成广告创意（文字、动画、图片、视频）展示给用户看。随着在线广告的发展，这种广告关系并没有消失，而是逐步演变成CPM的计费方式，并且通常是面向品牌广告主。一般来说，拥有规模较大，并且用户质量相对较好的媒体，都会存在这样的广告关系。





- 广告代理商（Advertising Agency）

​	Advertising Agency 即为“ 广告代理商”，习惯上也可以称为“ 广告公司”。 代理商一般由创作人员和经营管理人员所组成， 设有许多职能和业务部门， 能够为广告客户制定并实操完整的广告计划或商业宣传全案。代理商往往在制作广告和文案创意上有极强的实力。 广告业务，不仅需要技术，更需要创意。需要投放广告的个人或者公司，往往缺少专业的广告创意人才进行广告创意的设计，于是就有了广告代理商，为广告主设计广告文案和创意，并跟进最终的广告效果，从中赚取服务费。广告创意的形式很多，当前互联网上的主要是文字、图片、动画、视频以及交互式广告创意。

![](pic/ad-2.png)



-  广告网络（Ad Network）

在广告业内，这是一个较为广泛的概念，是一种介于想出售广告位的媒体与想在媒体上刊登广告的广告主之间的平台. 比较知名的大型广告网络公司如Google的AdSense。这样说，大家对广告网络（Ad Network）的认知可能还不够清晰。随着互联网的快速发展，网络上存在着大量的网站以及应用，他们单独一个的量级可能不大，由于流量不是很大，无法直接跟广告主去谈广告的投放，就算去谈，广告主也有可能看不上，而且一个个网站或者应用的谈，效率很低下。但是如果把这批媒体（中小网站和应用）聚拢起来就是很大的流量了，就拥有谈判的资本了。于是，广告网络出现了，它作为这批大量的中小媒体的中间者，获取广告主的广告，批量地运营媒体的广告位资源，按照人群或上下文标签售卖给需求方，并用竞价的方式决定流量分配。广告网络的结算以效果计费比如点击付费（ Cost per Click， CPC）或者CPA（Cost per Action）的方式为主。广告网络通常会提供一段JS code （JavaScript ，用于网站对接广告网络）或者SDK（Software Development Kit，用于对接App）。从聚拢大量中小流量的意义上说，比较大型的广告网络有 Google Adsence（面向网站）、Google Amob（面向移动APP）、Facebook Audience Network、百度网盟等（实际上，这几个平台已经不是单纯的Ad Network了）。当然也有很多量级没有这么大的其他广告网络，每个广告网络都拥有一批不少的流量

![](pic/ad-3.png)





- 互联网广告交易平台(Ad Exchange)

Ad Exchange即互联网广告交易平台，它联系着DSP（买方平台）和SSP（卖方平台），通过接入SSP汇集大量媒体流量，从而收集处理属于广告目标客户的数据，Ad Exchange是实现精准营销的交易场所。和股票交易平台类似的是，Ad Exchange 是通过实时竞价（RTB，Real Time Bidding）进行广告的交易的。这个广告平台以及技术的出现，使得广告的采购变得原来越规范和流程化——程序化交易。

关于Ad Exchange，我还有些要补充。在上面的内容中，我们介绍了广告网络（Ad Network），是一个介于媒体与广告主之间的一个平台。天下熙熙，皆为利来，天下攘攘，皆为利往。凡是有利可图，必然就会有多个参与者，广告网络也一样，随着市场的发展，市场上出现越来越多的广告网络，他们各自拥有自己的一批媒体，各自数据互不相通。如某一家广告网络可能有某一类广告主，但是却没有符合这类客户需求的媒体。这家广告网络同时拥有符合另一类客户需求的媒体，但可惜没有这类广告主。同时广告主若要投放广告，则需要多个广告网络的进行投放，广告物料和数据标准不统一，操作起来也非常的麻烦。而对于媒体来说，由于广告网络过多，则需要对接不同标准的接入代码（接入越多的代码，产品的稳定性越难保证），同时由于不同的广告网络之间对于同一个广告位的变现效率（收益）不同，媒体还需要对不同的时间不同的广告位和不同广告网络进行切换以达到收益的最大化。于是，Ad Exchange应运而生，实现了广告网络之间资源的打通和互换。Ad Exchange 通过一套数据协议，将不同广告主和广告网络（以及媒体）连接起来。

对于广告主，Ad exchange 提供一个名叫DSP（Demand-Side Platform）的平台，就是需求方平台，用于广告主对广告进行投放，对流量进行采买，对广告数据进行跟进，对广告的出价和策略进行调整。对于媒体或者publisher（开发者）Ad exchange则提供SSP（Supply-Side Platform，供应方平台），用于媒体或者publisher 对接广告主，管理媒体的广告位，查看广告收益等。对于广告的交易，Ad Exchange则提供RTB（Real Time Bidding，实时竞价）的交易方式，对于每一次的广告展示请求都通过实时竞价的方式进行匹配，从而使得媒体的收益最大化。对于平台的数据处理，Ad Exchange 则使用一个叫DMP（Data-Management Platform）数据管理平台，用于对广告主的需求、媒体所对应的用户的行为数据和标签进行分析，并最终返回匹配的广告受众。简单总结就是，Ad Exchange 是一个更高级的广告中介，整合了不同的广告主、广告网络和媒体，提供DSP、SSP、RTB、DMP等功能以实现广告投放的精准和媒体收益的最大化



![](pic/ad-4.png)



关于广告交易平台（Ad Exchange）还有几点需要补充：

1）上图的业务流程只是一个理想状态，实际上，广告的生态中广告网络的很多功能也趋向与广告交易平台，而广告生态中，广告网络和广告交易平台山头林立，同时存在多个广告网络和广告交易平台，当然最终手上有流量资源或者广告主资源的会最终胜出。比如国外的Facebook 和 Google，国内的百度、腾讯拥有巨大的流量，对广告主来说具有极大的谈判优势，同时由于广告主资源更多使得广告的变现效率更高更持续，因此更容易整合网络上的众多零散的流量资源。

2）关于RTB（Real Time Bidding，实时竞价），其定义：是一种利用第三方技术在数以百万计的网站或移动应用上针对每一个用户展示行为进行评估以及出价的竞价技术。RTB除了给广告主提供更为精准的用户标签外，还有一个很重要的功能是“实时竞价”。关于实时竞价，很多人联想到拍卖场的竞拍，那个是真的实时出价，而RTB的出价其实不是实时出价的。RTB出价其实是已经设定好的，Ad Exchange 对用户数据的精准分析得出各种标签和关键行为或者关键词，广告主对这些关键词进行设置自己的价格。当一次广告请求过来时，广告请求里带着受众的标签和相关的关键词信息，RTB 对这些标签和关键词进行匹配，得到对这些标签和关键词进行出价购买的广告主，然后实时的计算出最高价（最高变现效率）的广告主，返回广告给媒体。整个过程耗时在100毫秒内。RTB 的“实时”体现在每次的广告请求都重新计算最高价（最高变现效率），重新调整不同标签对应广告主（offer）的竞价排序。这个“实时”是相对于传统的广告网络的“离线”计算而言的，举例来说，一个以推广应用为主的广告网络，由于无法对用户进行精准的定义和打标签，因此会根据每个不同上游渠道（网盟）的广告（又称为offer）的广告流程的数据（比如点击率、安装率、激活率）等进行离线计算得到一个按照预估ECPM为指标的排序列表，每一次的广告请求过来后，服务端经过简单的过滤，每次都返回ECPM最优的广告的排序列表。而这个预估ECPM的排序列表是根据历史数据离线计算预估和定时更新的，并不是完全实时，假如这个时候有广告频繁的上下架，传统的广告网络是无法及时调整而导致广告平台收益的下降。

3）百度和Google的搜索广告，是属于那种广告生态？搜索广告是竞价广告的一种，主要是根据用户搜索关键词进行广告的竞价，是广告场景的一种。从广告的视角来看，也可以把付费搜索看作一种定向广告，即根据用户的即时兴趣定向投送的广告，而即时兴趣的标签就是关键词。 很显然， 这种定向广告从一开始就直接达到了非常精准的程度，也就很自然地采用了竞价的方式售卖。百度和Google的搜索广告绝大部分是直客广告，由于他们都拥有巨大的流量，因此都建立了自己的流量变现网络，其实已经拥有部分Ad Exchange的功能，比如说DSP，RTB等，因此百度和Google的搜索广告，是一种独立的广告系统，专注于自身流量的变现。而依托于本身巨大的流量和优势的广告主资源，他们对于整合和聚拢网络上众多零散的流量资源有很大优势，百度和Google 都建立了自己的广告网络平台，如百度网盟，Google AdSense。

4） 经常说的社交广告、信息流广告又是怎么一回事？社交广告是指在社交流量上展示的广告，而信息流广告是指在信息聚合流媒体上的广告，相对于搜索广告的用户主动触发而言，他们属于被动广告。这个是从广告的展示场景化来说的，属于更细化的一个层面，跟广告生态中的业务流程属于不同的角度。（广告变现场景也非常重要，这个后面有时间单独阐述）



#### 	广告投放过程

![1557899847858](pic/advertising.png)



### 第二节 互金广告业务流程(案例)



![](pic/广告投放.png)



#### 广告形式

```
1.Banner 横幅广告、通栏广告、广告条 
2 Notice 公告 这种方式常出现在电商类app上，通过消息广播的形式给用户传递相关信息
3 TableScreen 插屏 一般情况下插屏广告会出现在用户第一次点击某个功能页时弹出，显示需要提示的具体内容
4 FullScreen 启动页广告  启动页广告又称全屏广告（Full Screen Ads），几乎在常用的app上都能看到，可以以图片的形式、视频、Flash等形式加载。用户首次进入app时，将会出现启动页，当app后台运行再次进入时，启动页将不会出现
5 FeedsAds 信息流广告 信息流广告（Feeds Ads），这种广告伴随着信息而出现，用户在浏览信息时会不经意间浏览到广告
6 IntegralAds 积分广告 这种广告形式主要是通过下载注册赢取部分积分或优惠，以流量导流的方式把自身一部分用户流量导向目标app，实现流量变现
7 ViewAds 视频广告 视频广告针对的用户群体分为VIP用户和普通用户，VIP用户在购买VIP业务后能够直接跳过广告，普通用户则需要先把广告看完才能看后面的内容。所以，这种广告方式收入渠道分为两种：一种是会员业务，另一种是视频广告
8 BiddingAds 竞价排名 竞价排名的基本特点是按点击付费，推广信息出现在搜索（靠前）的结果中，如果没有被用户点击，则不收取推广费
```







### 第三节 数仓开发规范

```
1 数据库命名
    数据命名规则：数仓层_业务方式 如 ods_release/sda_release

2 数仓各层对应数据库
	ods/sda层 -> sda/ods_业务（原始数据）
	dw层 -> dw_业务 （主题库）
	dim层 -> dim_维度 （维表库）
	dm层 -> dm_业务（集市库）
	middle层 -> mid_业务（中间库）
	临时数据 -> temp（临时库）

3 表命名
    (3-1) 数据库表命名规则：
            原始层表：数仓层_来源类型_业务 如 ods_01_xxx
            其他表：数仓层_业务 如 dw_xxx
            
            如果业务名称较长可以简写 如 ods_01_xxx_xx_xx ods_01_xx

    (3-2) 数据来源代码(sda层)
        01 -> hdfs数据
        02 -> mysql数据
        03 -> redis数据
        04 -> mongodb数据
        05 -> tidb数据

如
    ods_release.ods_01_release 投放数据
    ods_release.ods_02_user 注册用户表(业务表：存于MYSQL)

    dw_release.dw_customer 目标客户主题表
    dm_release.dm_customer_stat 目标客户统计表
```



### 第四节 数仓建设

#### 业务数据库表(mysql)

###### 注册用户表

```sql
create table if not exists release.users (
	user_id varchar(18) NOT NULL COMMENT '用户id：手机号',
	user_pass varchar(30) NOT NULL COMMENT '用户密码',
	ctime timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  	PRIMARY KEY (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```



###### 物料信息表

```sql
create table if not exists release.materiel (
	matter_id varchar(10) NOT NULL COMMENT '物料编码',
	matter_type varchar(10) NOT NULL COMMENT '物料类型：1 图文 2 视频',
	matter_model varchar(30) NOT NULL COMMENT '物料对应模型',
	matter_model_version varchar(10) NOT NULL COMMENT '物料对应模型的版本',
	ctime timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  	PRIMARY KEY (`matter_id`,`matter_model`,`matter_model_version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```



###### 渠道通道映射表

```sql
create table if not exists release.sources_mapping_channels (
	sources varchar(20) NOT NULL COMMENT '渠道编码',
	sources_remark varchar(20) NOT NULL COMMENT '渠道描述',
	channels varchar(20) NOT NULL COMMENT '通道编码',
	channels_remark varchar(20) NOT NULL COMMENT '通道描述',
	media_type varchar(1) NOT NULL COMMENT '媒体类型',
	media_type_remark varchar(10) NOT NULL COMMENT '媒体类型描述',
	ctime timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  	PRIMARY KEY (`sources`,`channels`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

```
媒体类型：
    media_type='1' => '应用市场'
    media_type='2' => '场景类'
    media_type='3' => '短信'
    media_type='4' => '信息流'
    media_type='5' => '贷超'
```



#### 业务数据表(分布式)

#### ODS层库表

###### 广告投放原始数据

```sql
create external table if not exists ods_release.ods_01_release_session(
  sid string comment '投放请求id',
  release_session string comment '投放会话id',
  release_status string comment '参考下面投放流程状态说明',
  device_num string comment '设备唯一编码',
  device_type string comment '1 android| 2 ios | 9 其他',
  sources string comment '渠道',
  channels string comment '通道',
  exts string comment '扩展信息(参见下面扩展信息描述)',
  ct bigint comment '创建时间'
) partitioned by (bdp_day string)
stored as parquet
location '/data/release/ods/release_session/'
```



- 投放流程状态说明

```
非目标客户 -> 00 
目标客户 -> 01
竞价环节 -> 02
曝光环节 -> 03
点击环节 -> 04
到达环节 -> 05
注册环节 -> 06
```



- 扩展信息描述

```
1 获客阶段(非目标客户 + 目标客户)
exts={
    "idcard":"身份证"
    "longitude":"经度"
    "latitude":"纬度"
    "area_code":"地区"
    "matter_id":"物料代码"
    "model_code":"模型代码"
    "model_version":"模型版本"
    "aid":"广告位id"
}

2 竞价环节
exts={
	"bidding_status":"01 竞价出价阶段 |02 竞价成功阶段(竞价失败没有消息)"
    "bidding_type":"竞价类型 PMP直接出价|RTB竞价模式"
    "bidding_price":"出价（竞价出价|竞价获胜价格）"
    "aid":"广告位id"
}

3 曝光 -> 点击 -> 到达 
exts={
	//这里有关投放的物料信息是不传入的，可通过release_session关联获取的
}

4 注册
exts={
    "user_register":"手机号"
}

```



#### DW主题层库表

| 主题           | 描述        |
| -------------- | ----------- |
| 非目标客户主题 | status="00" |
| 目标客户主题   | status="01" |
| 竞价主题       | status="02" |
| 曝光主题       | status="03" |
| 点击主题       | status="04" |
| 到达主题       | status="05" |
| 注册主题       | status="06" |



<font color="red">各个主题表结构</font>

```
公共维度信息包括：
	release_session string comment '投放会话id',
	release_status string comment '参考下面投放流程状态说明',
	device_num string comment '设备唯一编码',
	device_type string comment '1 android| 2 ios | 9 其他',
	sources string comment '渠道',
	channels string comment '通道',
```



目标客户主题

```
create external table if not exists dw_release.dw_release_customer(
  release_session string comment '投放会话id',
  release_status string comment '参考下面投放流程状态说明',
  device_num string comment '设备唯一编码',
  device_type string comment '1 android| 2 ios | 9 其他',
  sources string comment '渠道',
  channels string comment '通道',
  idcard string comment '身份证',
  age int comment '年龄',
  gender string comment '性别',
  area_code string comment '地区',
  longitude string comment '经度',
  latitude string comment '纬度',
  matter_id string comment '物料代码',
  model_code string comment '模型代码',
  model_version string comment '模型版本',
  aid string comment '广告位id',
  ct bigint comment '创建时间'
) partitioned by (bdp_day string)
stored as parquet
location '/data/release/dw/release_customer/'
```







#### DIM维表层库表

```
参考业务数据库表的字典表，使用sqoop等技术进行同步
```

| 中文含义       | 表名                                 | 备注                   |
| -------------- | ------------------------------------ | ---------------------- |
| 时间维度表     | dim_release.date_dim                 | 日、周、月、季度、年等 |
| 地区维度表     | dim_release.region_dim               | 省、市、区等           |
| 渠道通道映射表 | dim_release.sources_mapping_channels | 渠道通道关系           |



#### DM集市层库表

```
1 根据主题层库表建设对应集市表
2 建立投放流程统计表(如各个环境的puv等统计信息)
```



目标客户集市库表

1 渠道用户统计

```
create external table if not exists dm_release.dm_customer_sources(
  sources string comment '渠道',
  channels string comment '通道',
  device_type string comment '1 android| 2 ios | 9 其他',
  user_count bigint comment '目标客户数量',
  total_count bigint comment '目标客户投放总量'
) partitioned by (bdp_day string)
stored as parquet
location '/data/release/dm/release_customer/dm_customer_sources/'
```



2 目标客户多维统计

维度 ->【
  device_type string comment '1 android| 2 ios | 9 其他',
  sources string comment '渠道',
  channels string comment '通道',
  age int comment '年龄',
  gender string comment '性别',
  area_code string comment '地区'】

量度 ->【 device_num string comment '设备唯一编码',  release_session string comment '投放会话id' 】

```
create external table if not exists dm_release.dm_customer_cube(
  sources string comment '渠道',
  channels string comment '通道',
  device_type string comment '1 android| 2 ios | 9 其他',
  age_range string comment '1:18岁以下|2:18-25岁|3 26-35岁|4 36-45岁|5 45岁以上',
  gender string comment '性别',
  area_code string comment '地区',
  user_count bigint comment '目标客户数量',
  total_count bigint comment '目标客户投放总量'
) partitioned by (bdp_day string)
stored as parquet
location '/data/release/dm/release_customer/dm_customer_cube/'
```

  





参考：

​	广告投放  <https://zhuanlan.zhihu.com/p/28488066>

​	腾讯广告业务说明 <https://www.jianshu.com/p/3a8916d049d0>

​    头条广告投放平台 <https://ad.toutiao.com/pages/login/index.html>

​	广告类型  <https://www.jianshu.com/p/0972198b27cc>

​	



